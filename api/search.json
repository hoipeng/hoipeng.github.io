[{"id":"ff294b41f6454d72b979d968dd4769d6","title":"测试","content":"Docker容器日志清理1.先查看磁盘空间\ndf -h\n\n2.找到容器的containerId-json.log文件,并清理(治标不治本，log迟早还会大的)\n查看各个容器的log文件大小\nfind &#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F; -name *-json.log |xargs du -sh\n\n执行清理\n$ cat &#x2F;dev&#x2F;null &gt; &#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;dfe25896671f0def031c5ffeb12dd335f7f54212c6ca5d3aca1c3f50b5e1eec4&#x2F;dfe25896671f0def031c5ffeb12dd335f7f54212c6ca5d3aca1c3f50b5e1eec4-json.log\n\n3.脚本化清理\n如果docker容器正在运行，那么使用rm -rf方式删除日志后，通过df -h会发现磁盘空间并没有释放。原因是在Linux或者Unix系统中，通过rm -rf或者文件管理器删除文件，将会从文件系统的目录结构上解除链接（unlink）。如果文件是被打开的（有一个进程正在使用），那么进程将仍然可以读取该文件，磁盘空间也一直被占用。正确姿势是cat &#x2F;dev&#x2F;null &gt; *-json.log，当然你也可以通过rm -rf删除后重启docker。接下来，提供一个日志清理脚本clean_docker_log.sh，内容如下：\n#!&#x2F;bin&#x2F;sh\n\necho &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; start clean docker containers logs &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;\n\nlogs&#x3D;$(find &#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F; -name *-json.log)\n\nfor log in $logs\n\tdo\n\t\techo &quot;clean logs : $log&quot;\n\t\tcat &#x2F;dev&#x2F;null &gt; $log\n\tdone\n\necho &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; end clean docker containers logs &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;\n\n# chmod +x clean_docker_log.sh\n# .&#x2F;clean_docker_log.sh\n\n但是，这样清理之后，随着时间的推移，容器日志会像杂草一样，卷土重来。\n4.设置Docker容器日志大小（治本）\n设置一个容器服务的日志大小上限\n上述方法，日志文件迟早又会涨回来。要从根本上解决问题，需要限制容器服务的日志大小上限。这个通过配置容器docker-compose的max-size选项来实现\nversion: &#39;3.3&#39;\nservices:\n  elasticsearch:\n    image: docker.elastic.co&#x2F;elasticsearch&#x2F;elasticsearch:7.5.0\n    container_name: elasticsearch\n    restart: always\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n    ports:\n      - 9200:9200\n    environment:\n      - discovery.type&#x3D;single-node\n      - bootstrap.memory_lock&#x3D;true\n      - &quot;ES_JAVA_OPTS&#x3D;-Xms512m -Xmx512m&quot;\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n  skywalking-oap:\n    image: apache&#x2F;skywalking-oap-server:6.6.0-es7\n    container_name: skywalking-oap\n    depends_on:\n      - elasticsearch\n    links:\n      - elasticsearch\n    restart: always\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n    ports:\n      - 11800:11800\n      - 12800:12800\n    environment:\n      - SW_STORAGE&#x3D;elasticsearch\n      - SW_STORAGE_ES_CLUSTER_NODES&#x3D;elasticsearch:9200\n  skywalking-ui:\n    image: apache&#x2F;skywalking-ui:6.6.0\n    container_name: skywalking-ui\n    depends_on:\n      - skywalking-oap\n    links:\n      - skywalking-oap\n    restart: always\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n    ports:\n      - 8480:8080\n    environment:\n      - SW_OAP_ADDRESS&#x3D;skywalking-oap:12800\n  nmg-monitor:\n    image: renren_io:2.0\n    container_name: nmg-monitor\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-monitor.jar:&#x2F;app&#x2F;app.jar\n  nmg-gateway:\n    image: renren_io:2.0\n    container_name: nmg-gateway\n    ports:\n      - &quot;8080:8080&quot;\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-gateway\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-gateway.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-auth:\n    image: renren_io:2.0\n    container_name: nmg-auth\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-auth\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-auth.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-admin:\n    image: renren_io:2.0\n    container_name: nmg-admin-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-admin\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-admin-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-oss:\n    image: renren_io:2.0\n    container_name: nmg-oss-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-oss-server\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-oss-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-job:\n    image: renren_io:2.0\n    container_name: nmg-job-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-job-server\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-job-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-message:\n    image: renren_io:2.0\n    container_name: nmg-message-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-message-server\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-message-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-flow:\n    image: renren_io:2.0\n    container_name: nmg-flow-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-flow-server\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-flow-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-api:\n    image: renren_io:2.0\n    container_name: nmg-api-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-api-server\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-api-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-cyyc:\n    image: renren_io:2.0\n    container_name: nmg-cyyc-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-cyyc-server\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-cyyc-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-metadata:\n    image: renren_io:2.0\n    container_name: nmg-metadata-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-metadata-server\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-metadata-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-qggb:\n    image: renren_io:2.0\n    container_name: nmg-qggb-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-qggb-server\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-qggb-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-qggwy:\n    image: renren_io:2.0\n    container_name: nmg-qggwy-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-qggwy-server\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-qggwy-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-dy:\n    image: renren_io:2.0\n    container_name: nmg-dy-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-dy-server\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-dy-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-cjgb:\n    image: renren_io:2.0\n    container_name: nmg-cjgb-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-cjgb-server\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-cjgb-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n  nmg-datav:\n    image: renren_io:2.0\n    container_name: nmg-datav-server\n    links:\n      - skywalking-oap\n    environment:\n      - SW_AGENT_NAME&#x3D;nmg-datav-server\n      - SW_AGENT_COLLECTOR_BACKEND_SERVICES&#x3D;skywalking-oap:11800\n    env_file:\n      - common.env\n    volumes:\n      - &#x2F;home&#x2F;xhzc&#x2F;nmg_gwy_cloud&#x2F;jar&#x2F;renren-datav-server.jar:&#x2F;app&#x2F;app.jar\n    logging:\n      driver: &quot;json-file&quot;\n      options:\n        max-size: &quot;5g&quot;\n\n重启nginx容器之后，其日志文件的大小就被限制在5GB，再也不用担心了。\n全局设置新建&#x2F;etc&#x2F;docker&#x2F;daemon.json，若有就不用新建了。添加log-dirver和log-opts参数，样例如下：\n\n\n\n\n\n\n\n\n\nvim &#x2F;etc&#x2F;docker&#x2F;daemon.json\n&#123;\n\t&quot;log-dirver&quot;: &quot;json-file&quot;,\n\t&quot;log-opts&quot;: &#123;\n\t\t&quot;max-size&quot;: &quot;5g&quot;,\n\t\t&quot;max-file&quot;: &quot;3&quot;\n\t&#125;\n&#125;\n\nmax-size&#x3D;5g，意味着一个容器日志大小上限是5G，max-file&#x3D;3，意味着一个容器有三个日志，分别是id+.json、id+1.json、id+2.json。\n&#x2F;&#x2F; 重启docker守护进程\nsystemctl daemon-reload\nsystemctl restart docker\n\n\n\n\n\n\n\n\n\n\n注意：设置的日志大小，只对新建的容器有效。\n参考：[https://blog.csdn.net/yjk13703623757/article/details/80283729](\n","slug":"测试","date":"2022-12-01T12:34:53.000Z","categories_index":"程序猿🐒,Docker","tags_index":"Docker","author_index":"慎独丶九思"},{"id":"cd21b4e6b83aafed33281c82b1994424","title":"设置MAC版Mysql的配置文件","content":"设置MAC版Mysql的配置文件1. 背景\n\n\n\n\n\n\n\n\nMac安装的Mysql8默认不会生成配置文件所以我需要创建个配置文件去让其加载。\n使用 Navicat 导入备份的时候，出现了 This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its 的错误，备份里面是包含了创建的函数的，在本地环境和服务器环境不一样就报错了。百度后发现是由于以下原因导致：\n\n\n\n\n\n\n\n\n\n创建函数时必须指定我们的函数是否是\n\nDETERMINISTIC 不确定的\nNO SQL 没有 SQL 语句，当然也不会修改数据\nREADS SQL DATA 只是读取数据，当然也不会修改数据\nMODIFIES SQL DATA 要修改数据\nCONTAINS SQL 包含了 SQL 语句\n\n解决方法：\n1、在 MySQL 数据库中执行以下语句，临时生效，重启后失效\nset global log_bin_trust_function_creators&#x3D;TRUE;\n\n2、在配置文件 my.ini 的 [mysqld] 配置，永久生效\nlog_bin_trust_function_creators&#x3D;1\n解决方法如下：\n1、在 MySQL 数据库中执行以下语句，临时生效，重启后失效\nset global log_bin_trust_function_creators&#x3D;TRUE;\n\n2、在配置文件 my.ini 的 [mysqld] 配置，永久生效\nlog_bin_trust_function_creators&#x3D;1\n\n2. 配置文件2.1 创建my.cnfMySQL默认安装在/usr/local/mysql-8.0.29-macos12-arm64\n\n在&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;support-files文件夹下创建my.cnf 内容如下：\n# Example MySQL config file for small systems.\n#\n# This is for a system with little memory (&lt;&#x3D; 64M) where MySQL is only used\n# from time to time and it&#39;s important that the mysqld daemon\n# doesn&#39;t use much resources.\n#\n# MySQL programs look for option files in a set of\n# locations which depend on the deployment platform.\n# You can copy this option file to one of those\n# locations. For information about these locations, see:\n# http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;mysql&#x2F;en&#x2F;option-files.html\n#\n# In this file, you can use all long options that a program supports.\n# If you want to know which options a program supports, run the program\n# with the &quot;--help&quot; option.\n# The following options will be passed to all MySQL clients\n[client]\ndefault-character-set&#x3D;utf8\n#password &#x3D; your_password\nport        &#x3D; 3336\nsocket      &#x3D; &#x2F;tmp&#x2F;mysql.sock\n# Here follows entries for some specific programs\n# The MySQL server\n[mysqld]\nsql_mode&#x3D;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\ndefault-storage-engine&#x3D;INNODB\ncharacter-set-server&#x3D;utf8\ncollation-server&#x3D;utf8_general_ci\nsocket      &#x3D; &#x2F;tmp&#x2F;mysql.sock\nlog_bin_trust_function_creators&#x3D;1\n# lower_case_table_names &#x3D; 1    # 是否对sql语句大小写敏感，1表示不敏感，即不区分大小写\n# skip-external-locking\n# key_buffer_size &#x3D; 16K\n# max_allowed_packet &#x3D; 1M\n# table_open_cache &#x3D; 4\n# sort_buffer_size &#x3D; 64K\n# read_buffer_size &#x3D; 256K\n# read_rnd_buffer_size &#x3D; 256K\n# net_buffer_length &#x3D; 2K\n# thread_stack &#x3D; 256K   # 该字段根据需要修改，默认是128K，我的是因为启动报了这个字段的错导致启动失败，所以我改成256K了\n\n# Don&#39;t listen on a TCP&#x2F;IP port at all. This can be a security enhancement,\n# if all processes that need to connect to mysqld run on the same host.\n# All interaction with mysqld must be made via Unix sockets or named pipes.\n# Note that using this option without enabling named pipes on Windows\n# (using the &quot;enable-named-pipe&quot; option) will render mysqld useless!\n#\n#skip-networking\nserver-id   &#x3D; 1\n# Uncomment the following if you want to log updates\n#log-bin&#x3D;mysql-bin\n# binary logging format - mixed recommended\n#binlog_format&#x3D;mixed\n# Causes updates to non-transactional engines using statement format to be\n# written directly to binary log. Before using this option make sure that\n# there are no dependencies between transactional and non-transactional\n# tables such as in the statement INSERT INTO t_myisam SELECT * FROM\n# t_innodb; otherwise, slaves may diverge from the master.\n#binlog_direct_non_transactional_updates&#x3D;TRUE\n# Uncomment the following if you are using InnoDB tables\n#innodb_data_home_dir &#x3D; &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data\n#innodb_data_file_path &#x3D; ibdata1:10M:autoextend\n#innodb_log_group_home_dir &#x3D; &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data\n# You can set .._buffer_pool_size up to 50 - 80 %\n# of RAM but beware of setting memory usage too high\n#innodb_buffer_pool_size &#x3D; 16M\n#innodb_additional_mem_pool_size &#x3D; 2M\n# Set .._log_file_size to 25 % of buffer pool size\n#innodb_log_file_size &#x3D; 5M\n#innodb_log_buffer_size &#x3D; 8M\n#innodb_flush_log_at_trx_commit &#x3D; 1\n#innodb_lock_wait_timeout &#x3D; 50\n[mysqldump]\nquick\n# max_allowed_packet &#x3D; 16M\n[mysql]\nno-auto-rehash\n# Remove the next comment character if you are not familiar with SQL\n#safe-updates\n[myisamchk]\n# key_buffer_size &#x3D; 8M\n# sort_buffer_size &#x3D; 8M\n[mysqlhotcopy]\ninteractive-timeout\n\n2.2 配置my.cnf\n2.3 重启数据库\n","slug":"设置MAC版Mysql的配置文件","date":"2022-12-01T02:12:51.000Z","categories_index":"程序猿🐒,奇怪的Mac知识点💻,MySQL,数据库","tags_index":"MAC,MySQL","author_index":"慎独丶九思"},{"id":"b9663f58f18133b35bfe243f3e916a80","title":"Hello World","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\nQuick StartCreate a new post$ hexo new &quot;My New Post&quot;\n\nMore info: Writing\nRun server$ hexo server\n\nMore info: Server\nGenerate static files$ hexo generate\n\nMore info: Generating\nDeploy to remote sites$ hexo deploy\n\nMore info: Deployment\n","slug":"hello-world","date":"2022-11-30T02:00:19.576Z","categories_index":"","tags_index":"","author_index":"慎独丶九思"}]